language: rust

cache: cargo

rust:
  - stable
  - beta

matrix:
  allow_failures:
    - rust: nightly
  include:
    - rust: nightly
      env: CLIPPY=true
    - rust: nightly-2017-07-06
      env: RUSTFLAGS="-Z sanitizer=thread"

script:
  - bash -c 'if [ -n "$CLIPPY" ]; then
                 cargo test --features="clippy";
             else
                 cargo test;
             fi'

os:
  - linux
  - osx
